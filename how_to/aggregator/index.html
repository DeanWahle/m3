


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.3">
    
    
      
        <title>M3Aggregator - M3 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.947af8d5.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-m3-aggregator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="M3 Documentation" class="md-header-nav__button md-logo" aria-label="M3 Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            M3 Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              M3Aggregator
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/m3db/m3/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    m3db/m3
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="M3 Documentation" class="md-nav__button md-logo" aria-label="M3 Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    M3 Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/m3db/m3/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    m3db/m3
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Overview
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Overview" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/components/" title="Components" class="md-nav__link">
      Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/motivation/" title="Motivation" class="md-nav__link">
      Motivation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/media/" title="Media" class="md-nav__link">
      Media
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      M3DB
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="M3DB" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        M3DB
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Architecture
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Architecture" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/engine/" title="Storage Engine" class="md-nav__link">
      Storage Engine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/sharding/" title="Sharding and Replication" class="md-nav__link">
      Sharding and Replication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/consistencylevels/" title="Consistency Levels" class="md-nav__link">
      Consistency Levels
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/storage/" title="Storage" class="md-nav__link">
      Storage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/commitlogs/" title="Commit Logs" class="md-nav__link">
      Commit Logs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/peer_streaming/" title="Peer Streaming" class="md-nav__link">
      Peer Streaming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/caching/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      M3 Coordinator
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="M3 Coordinator" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        M3 Coordinator
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3coordinator/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="API" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3coordinator/api/remote/" title="Prometheus Remote Write/Read" class="md-nav__link">
      Prometheus Remote Write/Read
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      M3 Query
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="M3 Query" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        M3 Query
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Configuration
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Configuration" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/config/" title="Query Engine" class="md-nav__link">
      Query Engine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/config/annotated_config/" title="Annotated Config File" class="md-nav__link">
      Annotated Config File
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="API" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/api/" title="Query" class="md-nav__link">
      Query
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Architecture
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Architecture" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/architecture/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/architecture/blocks/" title="Blocks" class="md-nav__link">
      Blocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/architecture/fanout/" title="Query Fanout" class="md-nav__link">
      Query Fanout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/architecture/functions/" title="Function Processing" class="md-nav__link">
      Function Processing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      How-To's
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="How-To's" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        How-To's
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../single_node/" title="M3DB Single Node Deployment" class="md-nav__link">
      M3DB Single Node Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cluster_hard_way/" title="M3DB Cluster Deployment, Manually" class="md-nav__link">
      M3DB Cluster Deployment, Manually
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubernetes/" title="M3DB on Kubernetes" class="md-nav__link">
      M3DB on Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../query/" title="M3Query" class="md-nav__link">
      M3Query
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        M3Aggregator
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="M3Aggregator" class="md-nav__link md-nav__link--active">
      M3Aggregator
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topology" class="md-nav__link">
    Topology
  </a>
  
    <nav class="md-nav" aria-label="Topology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initializing-aggregator-topology" class="md-nav__link">
    Initializing aggregator topology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-m3msg-topic-for-m3aggregator-to-receive-from-m3coordinators-to-aggregate-metrics" class="md-nav__link">
    Initializing m3msg topic for m3aggregator to receive from m3coordinators to aggregate metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-m3aggregagtor-consumer-group-to-ingest-topic" class="md-nav__link">
    Add m3aggregagtor consumer group to ingest topic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-m3msg-topic-for-m3coordinator-to-receive-from-m3aggregator-to-write-to-m3db" class="md-nav__link">
    Initializing m3msg topic for m3coordinator to receive from m3aggregator to write to M3DB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-m3coordinator-topology" class="md-nav__link">
    Initializing m3coordinator topology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-m3coordinator-consumer-group-to-outbound-topic" class="md-nav__link">
    Add m3coordinator consumer group to outbound topic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    Running
  </a>
  
    <nav class="md-nav" aria-label="Running">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dedicated-coordinator" class="md-nav__link">
    Dedicated Coordinator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3-aggregator" class="md-nav__link">
    M3 Aggregator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../use_as_tsdb/" title="Use M3DB as a general purpose time series database" class="md-nav__link">
      Use M3DB as a general purpose time series database
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Operational Guides
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Operational Guides" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Operational Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/replication_and_deployment_in_zones/" title="Replication and Deployment in Zones" class="md-nav__link">
      Replication and Deployment in Zones
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/upgrading_m3/" title="Upgrading M3" class="md-nav__link">
      Upgrading M3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/resource_limits/" title="Resource Limits and Preventing Abusive Reads/Writes" class="md-nav__link">
      Resource Limits and Preventing Abusive Reads/Writes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/availability_consistency_durability/" title="Tuning Availability, Consistency, and Durability" class="md-nav__link">
      Tuning Availability, Consistency, and Durability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/placement/" title="Placement/Topology" class="md-nav__link">
      Placement/Topology
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/placement_configuration/" title="Placement/Topology Configuration" class="md-nav__link">
      Placement/Topology Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/namespace_configuration/" title="Namespace Configuration" class="md-nav__link">
      Namespace Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/bootstrapping_crash_recovery/" title="Bootstrapping & Crash Recovery" class="md-nav__link">
      Bootstrapping & Crash Recovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/kernel_configuration/" title="Docker & Kernel Configuration" class="md-nav__link">
      Docker & Kernel Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/etcd/" title="etcd" class="md-nav__link">
      etcd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/mapping_rollup/" title="Configuring Mapping & Rollup Rules" class="md-nav__link">
      Configuring Mapping & Rollup Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/upgrading_m3/" title="Upgrading M3" class="md-nav__link">
      Upgrading M3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/repairs/" title="Repairs" class="md-nav__link">
      Repairs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operational_guide/replication_between_clusters/" title="Replication Between Clusters" class="md-nav__link">
      Replication Between Clusters
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Integrations
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Integrations" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/prometheus/" title="Prometheus" class="md-nav__link">
      Prometheus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/graphite/" title="Graphite" class="md-nav__link">
      Graphite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/grafana/" title="Grafana" class="md-nav__link">
      Grafana
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/influxdb/" title="InfluxDB" class="md-nav__link">
      InfluxDB
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faqs/" title="FAQs" class="md-nav__link">
      FAQs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../misc/writing_docs/" title="Tips For Writing Documentation" class="md-nav__link">
      Tips For Writing Documentation
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topology" class="md-nav__link">
    Topology
  </a>
  
    <nav class="md-nav" aria-label="Topology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initializing-aggregator-topology" class="md-nav__link">
    Initializing aggregator topology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-m3msg-topic-for-m3aggregator-to-receive-from-m3coordinators-to-aggregate-metrics" class="md-nav__link">
    Initializing m3msg topic for m3aggregator to receive from m3coordinators to aggregate metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-m3aggregagtor-consumer-group-to-ingest-topic" class="md-nav__link">
    Add m3aggregagtor consumer group to ingest topic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-m3msg-topic-for-m3coordinator-to-receive-from-m3aggregator-to-write-to-m3db" class="md-nav__link">
    Initializing m3msg topic for m3coordinator to receive from m3aggregator to write to M3DB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initializing-m3coordinator-topology" class="md-nav__link">
    Initializing m3coordinator topology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-m3coordinator-consumer-group-to-outbound-topic" class="md-nav__link">
    Add m3coordinator consumer group to outbound topic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    Running
  </a>
  
    <nav class="md-nav" aria-label="Running">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dedicated-coordinator" class="md-nav__link">
    Dedicated Coordinator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3-aggregator" class="md-nav__link">
    M3 Aggregator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/m3db/m3/edit/master/docs/how_to/aggregator.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="setting-up-m3-aggregator">Setting up M3 Aggregator</h1>
<h2 id="introduction">Introduction</h2>
<p><code>m3aggregator</code> is used to cluster stateful downsampling and rollup of metrics before they are store in M3DB. The M3 Coordinator also performs this role but is not cluster aware. This means metrics will not get aggregated properly if you send metrics in round robin fashion to multiple M3 Coordinators for the same metrics ingestion source (e.g. Prometheus server).</p>
<p>Similar to M3DB, <code>m3aggregator</code> supports clustering and replication by default. This means that metrics are correctly routed to the instance(s) responsible for aggregating each metric and multiple <code>m3aggregator</code> replicas can be configured such that there are no single points of failure for aggregation.</p>
<h2 id="configuration">Configuration</h2>
<p>Before setting up m3aggregator, make sure that you have at least <a href="../single_node/">one M3DB node running</a> and a dedicated m3coordinator setup.</p>
<p>We highly recommend running with at least a replication factor 2 for a <code>m3aggregator</code> deployment. If you run with replication factor 1 then when you restart an aggregator it will temporarily interrupt good the stream of aggregated metrics and there will be some data loss.</p>
<h3 id="topology">Topology</h3>
<h4 id="initializing-aggregator-topology">Initializing aggregator topology</h4>
<p>You can setup a m3aggregator topology by issuing a request to your coordinator (be sure to use your own hostnames, number of shards and replication factor):
<div class="highlight"><pre><span></span><code>curl -vvvsSf -H <span class="s2">&quot;Cluster-Environment-Name: namespace/m3db-cluster-name&quot;</span> -X POST http://m3dbnode-with-embedded-coordinator:7201/api/v1/services/m3aggregator/placement/init -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;num_shards&quot;: 64,</span>
<span class="s1">    &quot;replication_factor&quot;: 2,</span>
<span class="s1">    &quot;instances&quot;: [</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;m3aggregator01:6000&quot;,</span>
<span class="s1">            &quot;isolation_group&quot;: &quot;availability-zone-a&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;embedded&quot;,</span>
<span class="s1">            &quot;weight&quot;: 100,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;m3aggregator01:6000&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;m3aggregator01&quot;,</span>
<span class="s1">            &quot;port&quot;: 6000</span>
<span class="s1">        },</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;m3aggregator02:6000&quot;,</span>
<span class="s1">            &quot;isolation_group&quot;: &quot;availability-zone-b&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;embedded&quot;,</span>
<span class="s1">            &quot;weight&quot;: 100,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;m3aggregator02:6000&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;m3aggregator02&quot;,</span>
<span class="s1">            &quot;port&quot;: 6000</span>
<span class="s1">        }</span>
<span class="s1">    ]</span>
<span class="s1">}&#39;</span>
</code></pre></div></p>
<h4 id="initializing-m3msg-topic-for-m3aggregator-to-receive-from-m3coordinators-to-aggregate-metrics">Initializing m3msg topic for m3aggregator to receive from m3coordinators to aggregate metrics</h4>
<p>Now we must setup a topic for the <code>m3aggregator</code> to receive unaggregated metrics from <code>m3coordinator</code> instances:</p>
<div class="highlight"><pre><span></span><code>curl -vvvsSf -H <span class="s2">&quot;Cluster-Environment-Name: namespace/m3db-cluster-name&quot;</span> -H <span class="s2">&quot;Topic-Name: aggregator_ingest&quot;</span> -X POST http://m3dbnode-with-embedded-coordinator:7201/api/v1/topic/init -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;numberOfShards&quot;: 64</span>
<span class="s1">}&#39;</span>
</code></pre></div>

<h4 id="add-m3aggregagtor-consumer-group-to-ingest-topic">Add m3aggregagtor consumer group to ingest topic</h4>
<p>Add the <code>m3aggregator</code> placement to receive traffic from the topic (make sure to set message TTL to match your desired maximum in memory retry message buffer):
<div class="highlight"><pre><span></span><code>curl -vvvsSf -H <span class="s2">&quot;Cluster-Environment-Name: namespace/m3db-cluster-name&quot;</span> -H <span class="s2">&quot;Topic-Name: aggregator_ingest&quot;</span> -X POST http://m3dbnode-with-embedded-coordinator:7201/api/v1/topic -d <span class="s1">&#39;{</span>
<span class="s1">  &quot;consumerService&quot;: {</span>
<span class="s1">    &quot;serviceId&quot;: {</span>
<span class="s1">      &quot;name&quot;: &quot;m3aggregator&quot;,</span>
<span class="s1">      &quot;environment&quot;: &quot;namespace/m3db-cluster-name&quot;,</span>
<span class="s1">      &quot;zone&quot;: &quot;embedded&quot;</span>
<span class="s1">    },</span>
<span class="s1">    &quot;consumptionType&quot;: &quot;REPLICATED&quot;,</span>
<span class="s1">    &quot;messageTtlNanos&quot;: &quot;300000000000&quot;</span>
<span class="s1">  }</span>
<span class="s1">}&#39;</span>
</code></pre></div></p>
<p><strong>Note:</strong> 300000000000 nanoseconds is a TTL of 5 minutes for messages to rebuffer for retry.</p>
<h4 id="initializing-m3msg-topic-for-m3coordinator-to-receive-from-m3aggregator-to-write-to-m3db">Initializing m3msg topic for m3coordinator to receive from m3aggregator to write to M3DB</h4>
<p>Now we must setup a topic for the <code>m3coordinator</code> to receive aggregated metrics from <code>m3aggregator</code> instances to write to M3DB:
<div class="highlight"><pre><span></span><code>curl -vvvsSf -H <span class="s2">&quot;Cluster-Environment-Name: namespace/m3db-cluster-name&quot;</span> -H <span class="s2">&quot;Topic-Name: aggregated_metrics&quot;</span> -X POST http://m3dbnode-with-embedded-coordinator:7201/api/v1/topic/init -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;numberOfShards&quot;: 64</span>
<span class="s1">}&#39;</span>
</code></pre></div></p>
<h4 id="initializing-m3coordinator-topology">Initializing m3coordinator topology</h4>
<p>Then <code>m3coordinator</code> instances need to be configured to receive traffic for this topic (note ingest at port 7507 must match the configured port for your <code>m3coordinator</code> ingest server, see config at bottom of this guide):
<div class="highlight"><pre><span></span><code>curl -vvvsSf -H <span class="s2">&quot;Cluster-Environment-Name: namespace/m3db-cluster-name&quot;</span> -X POST http://m3dbnode-with-embedded-coordinator:7201/api/v1/services/m3coordinator/placement/init -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;instances&quot;: [</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;m3coordinator01&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;embedded&quot;,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;m3coordinator01:7507&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;m3coordinator01&quot;,</span>
<span class="s1">            &quot;port&quot;: 7507</span>
<span class="s1">        }</span>
<span class="s1">    ]</span>
<span class="s1">}&#39;</span>
</code></pre></div></p>
<p><strong>Note:</strong> When you add or remove <code>m3coordinator</code> instances they must be added to this placement.</p>
<h4 id="add-m3coordinator-consumer-group-to-outbound-topic">Add m3coordinator consumer group to outbound topic</h4>
<p>Add the <code>m3coordinator</code> placement to receive traffic from the topic (make sure to set message TTL to match your desired maximum in memory retry message buffer):
<div class="highlight"><pre><span></span><code>curl -vvvsSf -H <span class="s2">&quot;Cluster-Environment-Name: namespace/m3db-cluster-name&quot;</span> -H <span class="s2">&quot;Topic-Name: aggregated_metrics&quot;</span> -X POST http://m3dbnode-with-embedded-coordinator:7201/api/v1/topic -d <span class="s1">&#39;{</span>
<span class="s1">  &quot;consumerService&quot;: {</span>
<span class="s1">    &quot;serviceId&quot;: {</span>
<span class="s1">      &quot;name&quot;: &quot;m3coordinator&quot;,</span>
<span class="s1">      &quot;environment&quot;: &quot;namespace/m3db-cluster-name&quot;,</span>
<span class="s1">      &quot;zone&quot;: &quot;embedded&quot;</span>
<span class="s1">    },</span>
<span class="s1">    &quot;consumptionType&quot;: &quot;SHARED&quot;,</span>
<span class="s1">    &quot;messageTtlNanos&quot;: &quot;300000000000&quot;</span>
<span class="s1">  }</span>
<span class="s1">}&#39;</span>
</code></pre></div></p>
<p><strong>Note:</strong> 300000000000 nanoseconds is a TTL of 5 minutes for messages to rebuffer for retry.</p>
<h3 id="running">Running</h3>
<h4 id="dedicated-coordinator">Dedicated Coordinator</h4>
<p>Metrics will still arrive at the <code>m3coordinator</code>, they simply need to be forwarded to an <code>m3aggregator</code>. The <code>m3coordinator</code> then also needs to receive metrics that have been aggregated from the <code>m3aggregator</code> and store them in M3DB, so running an ingestion server should be configured.</p>
<p>Here is the config you should add to your <code>m3coordinator</code>:
<div class="highlight"><pre><span></span><code><span class="c1"># This is for sending metrics to the remote m3aggregators</span>
<span class="nt">downsample</span><span class="p">:</span>
  <span class="nt">remoteAggregator</span><span class="p">:</span>
    <span class="nt">client</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m3msg</span>
      <span class="nt">m3msg</span><span class="p">:</span>
        <span class="nt">producer</span><span class="p">:</span>
          <span class="nt">writer</span><span class="p">:</span>
            <span class="nt">topicName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aggregator_ingest</span>
            <span class="nt">topicServiceOverride</span><span class="p">:</span>
              <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
              <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">namespace/m3db-cluster-name</span>
            <span class="nt">placement</span><span class="p">:</span>
              <span class="nt">isStaged</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
            <span class="nt">placementServiceOverride</span><span class="p">:</span>
              <span class="nt">namespaces</span><span class="p">:</span>
                <span class="nt">placement</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/placement</span>
            <span class="nt">connection</span><span class="p">:</span>
              <span class="nt">numConnections</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
            <span class="nt">messagePool</span><span class="p">:</span>
              <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16384</span>
              <span class="nt">watermark</span><span class="p">:</span>
                <span class="nt">low</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.2</span>
                <span class="nt">high</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>

<span class="c1"># This is for configuring the ingestion server that will receive metrics from the m3aggregators on port 7507</span>
<span class="nt">ingest</span><span class="p">:</span>
  <span class="nt">ingester</span><span class="p">:</span>
    <span class="nt">workerPoolSize</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>
    <span class="nt">opPool</span><span class="p">:</span>
      <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>
    <span class="nt">retry</span><span class="p">:</span>
      <span class="nt">maxRetries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="nt">jitter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">logSampleRate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.01</span>
  <span class="nt">m3msg</span><span class="p">:</span>
    <span class="nt">server</span><span class="p">:</span>
      <span class="nt">listenAddress</span><span class="p">:</span> <span class="s">&quot;0.0.0.0:7507&quot;</span>
      <span class="nt">retry</span><span class="p">:</span>
        <span class="nt">maxBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
        <span class="nt">jitter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></p>
<h4 id="m3-aggregator">M3 Aggregator</h4>
<p>You can run <code>m3aggregator</code> by either building and running the binary yourself:</p>
<div class="highlight"><pre><span></span><code>make m3aggregator
./bin/m3aggregator -f ./src/aggregator/config/m3aggregator.yml
</code></pre></div>

<p>Or you can run it with Docker using the Docker file located at <code>docker/m3aggregator/Dockerfile</code> or the publicly provided image <code>quay.io/m3db/m3aggregator:latest</code>.</p>
<p>You can use a config like so, making note of the topics used such as <code>aggregator_ingest</code> and <code>aggregated_metrics</code> and the corresponding environment <code>namespace/m3db-cluster-name</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">logging</span><span class="p">:</span>
  <span class="nt">level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">info</span>

<span class="nt">metrics</span><span class="p">:</span>
  <span class="nt">scope</span><span class="p">:</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m3aggregator</span>
  <span class="nt">prometheus</span><span class="p">:</span>
    <span class="nt">onError</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">none</span>
    <span class="nt">handlerPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/metrics</span>
    <span class="nt">listenAddress</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0:6002</span>
    <span class="nt">timerType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">histogram</span>
  <span class="nt">sanitization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
  <span class="nt">samplingRate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.0</span>
  <span class="nt">extended</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">none</span>

<span class="nt">m3msg</span><span class="p">:</span>
  <span class="nt">server</span><span class="p">:</span>
    <span class="nt">listenAddress</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0:6000</span>
    <span class="nt">retry</span><span class="p">:</span>
      <span class="nt">maxBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
      <span class="nt">jitter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">consumer</span><span class="p">:</span>
    <span class="nt">messagePool</span><span class="p">:</span>
      <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16384</span>
      <span class="nt">watermark</span><span class="p">:</span>
        <span class="nt">low</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.2</span>
        <span class="nt">high</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>

<span class="nt">http</span><span class="p">:</span>
  <span class="nt">listenAddress</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0:6001</span>
  <span class="nt">readTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60s</span>
  <span class="nt">writeTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60s</span>

<span class="nt">kvClient</span><span class="p">:</span>
  <span class="nt">etcd</span><span class="p">:</span>
    <span class="nt">env</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">namespace/m3db-cluster-name</span>
    <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
    <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m3aggregator</span>
    <span class="nt">cacheDir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/m3kv</span>
    <span class="nt">etcdClusters</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
        <span class="nt">endpoints</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dbnode01:2379</span>

<span class="nt">runtimeOptions</span><span class="p">:</span>
  <span class="nt">kvConfig</span><span class="p">:</span>
    <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">namespace/m3db-cluster-name</span>
    <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
  <span class="nt">writeValuesPerMetricLimitPerSecondKey</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">write-values-per-metric-limit-per-second</span>
  <span class="nt">writeValuesPerMetricLimitPerSecond</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="nt">writeNewMetricLimitClusterPerSecondKey</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">write-new-metric-limit-cluster-per-second</span>
  <span class="nt">writeNewMetricLimitClusterPerSecond</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="nt">writeNewMetricNoLimitWarmupDuration</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="nt">aggregator</span><span class="p">:</span>
  <span class="nt">hostID</span><span class="p">:</span>
    <span class="nt">resolver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">environment</span>
    <span class="nt">envVarName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">M3AGGREGATOR_HOST_ID</span>
  <span class="nt">instanceID</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">host_id</span>
  <span class="nt">verboseErrors</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">metricPrefix</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">counterPrefix</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">timerPrefix</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">gaugePrefix</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">aggregationTypes</span><span class="p">:</span>
    <span class="nt">counterTransformFnType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">empty</span>
    <span class="nt">timerTransformFnType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">suffix</span>
    <span class="nt">gaugeTransformFnType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">empty</span>
    <span class="nt">aggregationTypesPool</span><span class="p">:</span>
      <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1024</span>
    <span class="nt">quantilesPool</span><span class="p">:</span>
      <span class="nt">buckets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">256</span>
          <span class="nt">capacity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
        <span class="p p-Indicator">-</span> <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">128</span>
          <span class="nt">capacity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
  <span class="nt">stream</span><span class="p">:</span>
    <span class="nt">eps</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.001</span>
    <span class="nt">capacity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>
    <span class="nt">streamPool</span><span class="p">:</span>
      <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4096</span>
    <span class="nt">samplePool</span><span class="p">:</span>
      <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4096</span>
    <span class="nt">floatsPool</span><span class="p">:</span>
      <span class="nt">buckets</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4096</span>
          <span class="nt">capacity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
        <span class="p p-Indicator">-</span> <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2048</span>
          <span class="nt">capacity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>
        <span class="p p-Indicator">-</span> <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1024</span>
          <span class="nt">capacity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">64</span>
  <span class="nt">client</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m3msg</span>
    <span class="nt">m3msg</span><span class="p">:</span>
      <span class="nt">producer</span><span class="p">:</span>
        <span class="nt">writer</span><span class="p">:</span>
          <span class="nt">topicName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aggregator_ingest</span>
          <span class="nt">topicServiceOverride</span><span class="p">:</span>
            <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
            <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">namespace/m3db-cluster-name</span>
          <span class="nt">placement</span><span class="p">:</span>
            <span class="nt">isStaged</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
          <span class="nt">placementServiceOverride</span><span class="p">:</span>
            <span class="nt">namespaces</span><span class="p">:</span>
              <span class="nt">placement</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/placement</span>
          <span class="nt">messagePool</span><span class="p">:</span>
            <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16384</span>
            <span class="nt">watermark</span><span class="p">:</span>
              <span class="nt">low</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.2</span>
              <span class="nt">high</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
  <span class="nt">placementManager</span><span class="p">:</span>
    <span class="nt">kvConfig</span><span class="p">:</span>
      <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/placement</span>
      <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">namespace/m3db-cluster-name</span>
      <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
    <span class="nt">placementWatcher</span><span class="p">:</span>
      <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m3aggregator</span>
      <span class="nt">initWatchTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
  <span class="nt">hashType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">murmur32</span>
  <span class="nt">bufferDurationBeforeShardCutover</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
  <span class="nt">bufferDurationAfterShardCutoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
  <span class="nt">bufferDurationForFutureTimedMetric</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span> <span class="c1"># Allow test to write into future.</span>
  <span class="nt">resignTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1m</span>
  <span class="nt">flushTimesManager</span><span class="p">:</span>
    <span class="nt">kvConfig</span><span class="p">:</span>
      <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">namespace/m3db-cluster-name</span>
      <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
    <span class="nt">flushTimesKeyFmt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">shardset/%d/flush</span>
    <span class="nt">flushTimesPersistRetrier</span><span class="p">:</span>
      <span class="nt">initialBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100ms</span>
      <span class="nt">backoffFactor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2.0</span>
      <span class="nt">maxBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2s</span>
      <span class="nt">maxRetries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="nt">electionManager</span><span class="p">:</span>
    <span class="nt">election</span><span class="p">:</span>
      <span class="nt">leaderTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
      <span class="nt">resignTimeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
      <span class="nt">ttlSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
    <span class="nt">serviceID</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m3aggregator</span>
      <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">namespace/m3db-cluster-name</span>
      <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
    <span class="nt">electionKeyFmt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">shardset/%d/lock</span>
    <span class="nt">campaignRetrier</span><span class="p">:</span>
      <span class="nt">initialBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100ms</span>
      <span class="nt">backoffFactor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2.0</span>
      <span class="nt">maxBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2s</span>
      <span class="nt">forever</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">jitter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">changeRetrier</span><span class="p">:</span>
      <span class="nt">initialBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100ms</span>
      <span class="nt">backoffFactor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2.0</span>
      <span class="nt">maxBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>
      <span class="nt">forever</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">jitter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">resignRetrier</span><span class="p">:</span>
      <span class="nt">initialBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100ms</span>
      <span class="nt">backoffFactor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2.0</span>
      <span class="nt">maxBackoff</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>
      <span class="nt">forever</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">jitter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">campaignStateCheckInterval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1s</span>
    <span class="nt">shardCutoffCheckOffset</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30s</span>
  <span class="nt">flushManager</span><span class="p">:</span>
    <span class="nt">checkEvery</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1s</span>
    <span class="nt">jitterEnabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">maxJitters</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">flushInterval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>
        <span class="nt">maxJitterPercent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.0</span>
      <span class="p p-Indicator">-</span> <span class="nt">flushInterval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
        <span class="nt">maxJitterPercent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
      <span class="p p-Indicator">-</span> <span class="nt">flushInterval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1m</span>
        <span class="nt">maxJitterPercent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
      <span class="p p-Indicator">-</span> <span class="nt">flushInterval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
        <span class="nt">maxJitterPercent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
      <span class="p p-Indicator">-</span> <span class="nt">flushInterval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1h</span>
        <span class="nt">maxJitterPercent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.25</span>
    <span class="nt">numWorkersPerCPU</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
    <span class="nt">flushTimesPersistEvery</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
    <span class="nt">maxBufferSize</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5m</span>
    <span class="nt">forcedFlushWindowSize</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
  <span class="nt">flush</span><span class="p">:</span>
    <span class="nt">handlers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">dynamicBackend</span><span class="p">:</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m3msg</span>
          <span class="nt">hashType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">murmur32</span>
          <span class="nt">producer</span><span class="p">:</span>
            <span class="nt">writer</span><span class="p">:</span>
              <span class="nt">topicName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aggregated_metrics</span>
              <span class="nt">topicServiceOverride</span><span class="p">:</span>
                <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">embedded</span>
                <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">namespace/m3db-cluster-name</span>
              <span class="nt">messagePool</span><span class="p">:</span>
                <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16384</span>
                <span class="nt">watermark</span><span class="p">:</span>
                  <span class="nt">low</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.2</span>
                  <span class="nt">high</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
  <span class="nt">passthrough</span><span class="p">:</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">forwarding</span><span class="p">:</span>
    <span class="nt">maxConstDelay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5m</span> <span class="c1"># Need to add some buffer window, since timed metrics by default are delayed by 1min.</span>
  <span class="nt">entryTTL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1h</span>
  <span class="nt">entryCheckInterval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
  <span class="nt">maxTimerBatchSizePerWrite</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">140</span>
  <span class="nt">defaultStoragePolicies</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
  <span class="nt">maxNumCachedSourceSets</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="nt">discardNaNAggregatedValues</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">entryPool</span><span class="p">:</span>
    <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4096</span>
  <span class="nt">counterElemPool</span><span class="p">:</span>
    <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4096</span>
  <span class="nt">timerElemPool</span><span class="p">:</span>
    <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4096</span>
  <span class="nt">gaugeElemPool</span><span class="p">:</span>
    <span class="nt">size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4096</span>
</code></pre></div>

<h2 id="usage">Usage</h2>
<p>Send metrics as usual to your <code>m3coordinator</code> instances in round robin fashion (or any other load balancing strategy), the metrics will be forwarded to the <code>m3aggregator</code> instances, then once aggregated they will be returned to the <code>m3coordinator</code> instances to write to M3DB.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../query/" title="M3Query" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                M3Query
              </div>
            </div>
          </a>
        
        
          <a href="../use_as_tsdb/" title="Use M3DB as a general purpose time series database" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Use M3DB as a general purpose time series database
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.c3dc8c49.min.js"></script>
      <script src="../../assets/javascripts/bundle.f9edbbd5.min.js"></script><script id="__lang" type="application/json">{"search.config.lang": "en", "search.result.other": "# matching documents", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.placeholder": "Type to start searching", "clipboard.copy": "Copy to clipboard", "search.config.pipeline": "trimmer, stopWordFilter", "clipboard.copied": "Copied to clipboard", "search.config.separator": "[\\s\\-]+"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>