


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.3">
    
    
      
        <title>Placement/Topology Configuration - M3 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.947af8d5.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#placement-configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="M3 Documentation" class="md-header-nav__button md-logo" aria-label="M3 Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            M3 Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Placement/Topology Configuration
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/m3db/m3/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    m3db/m3
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="M3 Documentation" class="md-nav__button md-logo" aria-label="M3 Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    M3 Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/m3db/m3/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    m3db/m3
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Overview
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Overview" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/components/" title="Components" class="md-nav__link">
      Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/motivation/" title="Motivation" class="md-nav__link">
      Motivation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/media/" title="Media" class="md-nav__link">
      Media
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      M3DB
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="M3DB" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        M3DB
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Architecture
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Architecture" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/engine/" title="Storage Engine" class="md-nav__link">
      Storage Engine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/sharding/" title="Sharding and Replication" class="md-nav__link">
      Sharding and Replication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/consistencylevels/" title="Consistency Levels" class="md-nav__link">
      Consistency Levels
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/storage/" title="Storage" class="md-nav__link">
      Storage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/commitlogs/" title="Commit Logs" class="md-nav__link">
      Commit Logs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/peer_streaming/" title="Peer Streaming" class="md-nav__link">
      Peer Streaming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/caching/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      M3 Coordinator
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="M3 Coordinator" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        M3 Coordinator
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3coordinator/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="API" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3coordinator/api/remote/" title="Prometheus Remote Write/Read" class="md-nav__link">
      Prometheus Remote Write/Read
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      M3 Query
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="M3 Query" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        M3 Query
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Configuration
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Configuration" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/config/" title="Query Engine" class="md-nav__link">
      Query Engine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/config/annotated_config/" title="Annotated Config File" class="md-nav__link">
      Annotated Config File
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="API" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/api/" title="Query" class="md-nav__link">
      Query
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Architecture
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Architecture" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/architecture/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/architecture/blocks/" title="Blocks" class="md-nav__link">
      Blocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/architecture/fanout/" title="Query Fanout" class="md-nav__link">
      Query Fanout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3query/architecture/functions/" title="Function Processing" class="md-nav__link">
      Function Processing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      How-To's
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="How-To's" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        How-To's
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/single_node/" title="M3DB Single Node Deployment" class="md-nav__link">
      M3DB Single Node Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/cluster_hard_way/" title="M3DB Cluster Deployment, Manually" class="md-nav__link">
      M3DB Cluster Deployment, Manually
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/kubernetes/" title="M3DB on Kubernetes" class="md-nav__link">
      M3DB on Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/query/" title="M3Query" class="md-nav__link">
      M3Query
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/aggregator/" title="M3Aggregator" class="md-nav__link">
      M3Aggregator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/use_as_tsdb/" title="Use M3DB as a general purpose time series database" class="md-nav__link">
      Use M3DB as a general purpose time series database
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Operational Guides
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Operational Guides" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Operational Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../replication_and_deployment_in_zones/" title="Replication and Deployment in Zones" class="md-nav__link">
      Replication and Deployment in Zones
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../upgrading_m3/" title="Upgrading M3" class="md-nav__link">
      Upgrading M3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resource_limits/" title="Resource Limits and Preventing Abusive Reads/Writes" class="md-nav__link">
      Resource Limits and Preventing Abusive Reads/Writes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../availability_consistency_durability/" title="Tuning Availability, Consistency, and Durability" class="md-nav__link">
      Tuning Availability, Consistency, and Durability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../placement/" title="Placement/Topology" class="md-nav__link">
      Placement/Topology
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Placement/Topology Configuration
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Placement/Topology Configuration" class="md-nav__link md-nav__link--active">
      Placement/Topology Configuration
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-placement-configuration" class="md-nav__link">
    Understanding the Placement Configuration
  </a>
  
    <nav class="md-nav" aria-label="Understanding the Placement Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id" class="md-nav__link">
    ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isolation-group" class="md-nav__link">
    Isolation Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zone" class="md-nav__link">
    Zone
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weight" class="md-nav__link">
    Weight
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoint" class="md-nav__link">
    Endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostname" class="md-nav__link">
    Hostname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port" class="md-nav__link">
    Port
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#placement-operations" class="md-nav__link">
    Placement Operations
  </a>
  
    <nav class="md-nav" aria-label="Placement Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#placement-initialization" class="md-nav__link">
    Placement Initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-node" class="md-nav__link">
    Adding a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-a-node" class="md-nav__link">
    Removing a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-removing-seed-nodes" class="md-nav__link">
    Adding / Removing Seed Nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacing-a-node" class="md-nav__link">
    Replacing a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacing-a-seed-node" class="md-nav__link">
    Replacing a Seed Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-a-new-placement-not-recommended" class="md-nav__link">
    Setting a new placement (Not Recommended)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../namespace_configuration/" title="Namespace Configuration" class="md-nav__link">
      Namespace Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bootstrapping_crash_recovery/" title="Bootstrapping & Crash Recovery" class="md-nav__link">
      Bootstrapping & Crash Recovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kernel_configuration/" title="Docker & Kernel Configuration" class="md-nav__link">
      Docker & Kernel Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../etcd/" title="etcd" class="md-nav__link">
      etcd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mapping_rollup/" title="Configuring Mapping & Rollup Rules" class="md-nav__link">
      Configuring Mapping & Rollup Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../upgrading_m3/" title="Upgrading M3" class="md-nav__link">
      Upgrading M3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../repairs/" title="Repairs" class="md-nav__link">
      Repairs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../replication_between_clusters/" title="Replication Between Clusters" class="md-nav__link">
      Replication Between Clusters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fileset_migrations/" title="Fileset Migrations" class="md-nav__link">
      Fileset Migrations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Integrations
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Integrations" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/prometheus/" title="Prometheus" class="md-nav__link">
      Prometheus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/graphite/" title="Graphite" class="md-nav__link">
      Graphite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/grafana/" title="Grafana" class="md-nav__link">
      Grafana
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/influxdb/" title="InfluxDB" class="md-nav__link">
      InfluxDB
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faqs/" title="FAQs" class="md-nav__link">
      FAQs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../misc/writing_docs/" title="Tips For Writing Documentation" class="md-nav__link">
      Tips For Writing Documentation
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-placement-configuration" class="md-nav__link">
    Understanding the Placement Configuration
  </a>
  
    <nav class="md-nav" aria-label="Understanding the Placement Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id" class="md-nav__link">
    ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isolation-group" class="md-nav__link">
    Isolation Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zone" class="md-nav__link">
    Zone
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weight" class="md-nav__link">
    Weight
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoint" class="md-nav__link">
    Endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostname" class="md-nav__link">
    Hostname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port" class="md-nav__link">
    Port
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#placement-operations" class="md-nav__link">
    Placement Operations
  </a>
  
    <nav class="md-nav" aria-label="Placement Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#placement-initialization" class="md-nav__link">
    Placement Initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-node" class="md-nav__link">
    Adding a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-a-node" class="md-nav__link">
    Removing a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-removing-seed-nodes" class="md-nav__link">
    Adding / Removing Seed Nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacing-a-node" class="md-nav__link">
    Replacing a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacing-a-seed-node" class="md-nav__link">
    Replacing a Seed Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-a-new-placement-not-recommended" class="md-nav__link">
    Setting a new placement (Not Recommended)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/m3db/m3/edit/master/docs/operational_guide/placement_configuration.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="placement-configuration">Placement Configuration</h1>
<h2 id="overview">Overview</h2>
<p>M3DB was designed from the ground up to be a distributed (clustered) database that is availability zone or rack aware (by using isolation groups). Clusters will seamlessly scale with your data, and you can start with a small number of nodes and grow it to a size of several hundred nodes with no downtime or expensive migrations.</p>
<p>Before reading the rest of this document, we recommend familiarizing yourself with the <a href="../placement/">M3DB placement documentation</a></p>
<p><strong>Note</strong>: The primary limiting factor for the maximum size of an M3DB cluster is the number of shards. Picking an appropriate number of shards is more of an art than a science, but our recommendation is as follows:</p>
<p>The number of shards that M3DB uses is configurable and there are a couple of key points to note when deciding the number to use. The
more nodes you have, the more shards you want because you want the shards to be evenly distributed amongst your nodes. However,
because each shard requires more files to be created, you also don’t want to have too many shards per node. This is due to the fact each
bit of data needs to be repartitioned and moved around the cluster (i.e. every bit of data needs to be moved all at once). Below are
some guidelines depending on how many nodes you will have in your cluster eventually - you will need to decide the number of shards up front, you
cannot change this once the cluster is created.</p>
<table>
<thead>
<tr>
<th>Number of Nodes</th>
<th>Number of Shards</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>64</td>
</tr>
<tr>
<td>6</td>
<td>128</td>
</tr>
<tr>
<td>12</td>
<td>256</td>
</tr>
<tr>
<td>24</td>
<td>512</td>
</tr>
<tr>
<td>48</td>
<td>1024</td>
</tr>
<tr>
<td>128+</td>
<td>4096</td>
</tr>
</tbody>
</table>
<p>After performing any of the instructions documented below a new placement will automatically be generated to distribute the shards among the M3DB nodes such that the isolation group and replication factor constraints are met.</p>
<p>If the constraints cannot be met, because there are not enough nodes to calculate a new placement such that each shard is replicated on the desired number of nodes with none of the nodes owning the same shard existing in the same isolation group, then the operation will fail.</p>
<p>In other words, all you have to do is issue the desired instruction and the M3 stack will take care of making sure that your data is distributed with appropriate replication and isolation.</p>
<p>In the case of the M3DB nodes, nodes that have received new shards will immediately begin receiving writes (but not serving reads) for the new shards that they are responsible for. They will also begin streaming in all the data for their newly acquired shards from the peers that already have data for those shards. Once the nodes have finished streaming in the data for the shards that they have acquired, they will mark their status for those shards as <code>Available</code> in the placement and begin accepting writes. Simultaneously, the nodes that are losing ownership of any shards will mark their status for those shards as <code>Leaving</code>. Once all the nodes accepting ownership of the new shards have finished streaming data from them, they will relinquish ownership of those shards and remove all the data associated with the shards they lost from memory and from disk.</p>
<p>M3Coordinator nodes will also pickup the new placement from etcd and alter which M3DB nodes they issue writes and reads to appropriately.</p>
<h3 id="understanding-the-placement-configuration">Understanding the Placement Configuration</h3>
<p>The placement configuration contains a few core values that control how the placement behaves.</p>
<h4 id="id">ID</h4>
<p>This is the identifier for a node in the placement and can be any value that uniquely identifies an M3DB node.</p>
<h4 id="isolation-group">Isolation Group</h4>
<p>This value controls how nodes that own the same M3DB shards are isolated from each other. For example, in a single datacenter configuration this value could be set to the rack that the M3DB node lives on. As a result, the placement will guarantee that nodes that exist on the same rack do not share any shards, allowing the cluster to survive the failure of an entire rack. Alternatively, if M3DB was deployed in an AWS region, the isolation group could be set to the region's availability zone and that would ensure that the cluster would survive the loss of an entire availability zone.</p>
<h4 id="zone">Zone</h4>
<p>This value controls what etcd zone the M3DB node belongs to.</p>
<h4 id="weight">Weight</h4>
<p>This value should be an integer and controls how the cluster will weigh the number of shards that an individual node will own. If you're running the M3DB cluster on homogenous hardware, then you probably want to assign all M3DB nodes the same weight so that shards are distributed evenly. On the otherhand, if you're running the cluster on heterogenous hardware, then this value should be higher for nodes with higher resources for whatever the limiting factor is in your cluster setup. For example, if disk space (as opposed to memory or CPU) is the limiting factor in how many shards any given node in your cluster can tolerate, then you could assign a higher value to nodes in your cluster that have larger disks and the placement calculations would assign them a higher number of shards.</p>
<h4 id="endpoint">Endpoint</h4>
<p>This value should be in the form of <code>&lt;M3DB_HOST_NAME&gt;:&lt;M3DB_NODE_LISTEN_PORT&gt;</code> and identifies how network requests should be routed to this particular node in the placement.</p>
<h4 id="hostname">Hostname</h4>
<p>This value should be in the form of <code>&lt;M3DB_HOST_NAME&gt;</code> and identifies the address / host name of the M3DB node.</p>
<h4 id="port">Port</h4>
<p>This value should be in the form of <code>&lt;M3DB_NODE_LISTEN_PORT&gt;</code> and identifies the port over which this M3DB node expects to receive traffic (defaults to 9000).</p>
<h3 id="placement-operations">Placement Operations</h3>
<p><strong>NOTE</strong>: If you find yourself performing operations on seed nodes, please refer to the seed node-specific sections
below before making changes.</p>
<p>The instructions below all contain sample curl commands, but you can always review the API documentation by navigating to</p>
<p><code>http://&lt;M3_COORDINATOR_HOST_NAME&gt;:&lt;CONFIGURED_PORT(default 7201)&gt;/api/v1/openapi</code> or our <a href="https://m3db.io/openapi/">online API documentation</a>.</p>
<p><strong>Note</strong>: The <a href="../bootstrapping_crash_recovery/">peers bootstrapper</a> must be configured on all nodes in the M3DB cluster for placement changes to work. The <code>peers</code> bootstrapper is enabled by default, so you only need to worry about this if you modified the default bootstrapping configuration</p>
<p>Additionally, the following headers can be used in the placement operations: </p>
<ul>
<li><code>Cluster-Environment-Name</code>:<br />
 This header is used to specify the cluster environment name. If not set, the default <code>default_env</code> is used. 
<br /></li>
<li><code>Cluster-Zone-Name</code>:<br />
 This header is used to specify the cluster zone name. If not set, the default <code>embedded</code> is used. </li>
</ul>
<h4 id="placement-initialization">Placement Initialization</h4>
<p>Send a POST request to the <code>/api/v1/services/m3db/placement/init</code> endpoint</p>
<div class="highlight"><pre><span></span><code>curl -X POST localhost:7201/api/v1/services/m3db/placement/init -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;num_shards&quot;: &lt;DESIRED_NUMBER_OF_SHARDS&gt;,</span>
<span class="s1">    &quot;replication_factor&quot;: &lt;DESIRED_REPLICATION_FACTOR&gt;(recommended 3),</span>
<span class="s1">    &quot;instances&quot;: [</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;&lt;NODE_1_ID&gt;&quot;,</span>
<span class="s1">            &quot;isolation_group&quot;: &quot;&lt;NODE_1_ISOLATION_GROUP&gt;&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,</span>
<span class="s1">            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;&lt;NODE_1_HOST_NAME&gt;:&lt;NODE_1_PORT&gt;&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;&lt;NODE_1_HOST_NAME&gt;&quot;,</span>
<span class="s1">            &quot;port&quot;: &lt;NODE_1_PORT&gt;</span>
<span class="s1">        },</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;&lt;NODE_2_ID&gt;&quot;,</span>
<span class="s1">            &quot;isolation_group&quot;: &quot;&lt;NODE_2_ISOLATION_GROUP&gt;&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,</span>
<span class="s1">            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;&lt;NODE_2_HOST_NAME&gt;:&lt;NODE_2_PORT&gt;&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;&lt;NODE_2_HOST_NAME&gt;&quot;,</span>
<span class="s1">            &quot;port&quot;: &lt;NODE_2_PORT&gt;</span>
<span class="s1">        },</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;&lt;NODE_3_ID&gt;&quot;,</span>
<span class="s1">            &quot;isolation_group&quot;: &quot;&lt;NODE_3_ISOLATION_GROUP&gt;&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,</span>
<span class="s1">            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;&lt;NODE_3_HOST_NAME&gt;:&lt;NODE_3_PORT&gt;&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;&lt;NODE_3_HOST_NAME&gt;&quot;,</span>
<span class="s1">            &quot;port&quot;: &lt;NODE_3_PORT&gt;</span>
<span class="s1">        }</span>
<span class="s1">    ]</span>
<span class="s1">}&#39;</span>
</code></pre></div>

<h4 id="adding-a-node">Adding a Node</h4>
<p>Send a POST request to the <code>/api/v1/services/m3db/placement</code> endpoint</p>
<div class="highlight"><pre><span></span><code>curl -X POST &lt;M3_COORDINATOR_HOST_NAME&gt;:&lt;M3_COORDINATOR_PORT<span class="o">(</span>default <span class="m">7201</span><span class="o">)</span>&gt;/api/v1/services/m3db/placement -d <span class="s1">&#39;{</span>
<span class="s1">  &quot;instances&quot;: [</span>
<span class="s1">    {</span>
<span class="s1">      &quot;id&quot;: &quot;&lt;NEW_NODE_ID&gt;&quot;,</span>
<span class="s1">      &quot;isolationGroup&quot;: &quot;&lt;NEW_NODE_ISOLATION_GROUP&gt;&quot;,</span>
<span class="s1">      &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,</span>
<span class="s1">      &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,</span>
<span class="s1">      &quot;endpoint&quot;: &quot;&lt;NEW_NODE_HOST_NAME&gt;:&lt;NEW_NODE_PORT&gt;(default 9000)&quot;,</span>
<span class="s1">      &quot;hostname&quot;: &quot;&lt;NEW_NODE_HOST_NAME&gt;&quot;,</span>
<span class="s1">      &quot;port&quot;: &lt;NEW_NODE_PORT&gt;</span>
<span class="s1">    }</span>
<span class="s1">  ]</span>
<span class="s1">}&#39;</span>
</code></pre></div>

<p>After sending the add command you will need to wait for the M3DB cluster to reach the new desired state. You'll know that this has been achieved when the placement shows that all shards for all hosts are in the <code>Available</code> state.</p>
<h4 id="removing-a-node">Removing a Node</h4>
<p>Send a DELETE request to the <code>/api/v1/services/m3db/placement/&lt;NODE_ID&gt;</code> endpoint.</p>
<div class="highlight"><pre><span></span><code>curl -X DELETE &lt;M3_COORDINATOR_HOST_NAME&gt;:&lt;M3_COORDINATOR_PORT<span class="o">(</span>default <span class="m">7201</span><span class="o">)</span>&gt;/api/v1/services/m3db/placement/&lt;NODE_ID&gt;
</code></pre></div>

<p>After sending the delete command you will need to wait for the M3DB cluster to reach the new desired state. You'll know that this has been achieved when the placement shows that all shards for all hosts are in the <code>Available</code> state.</p>
<h4 id="adding-removing-seed-nodes">Adding / Removing Seed Nodes</h4>
<p>If you find yourself adding or removing etcd seed nodes then we highly recommend setting up an <a href="../etcd/">external etcd</a> cluster, as
the overhead of operating two stateful systems at once is non-trivial. As this is not a recommended production setup,
this section is intentionally brief.</p>
<p>To add or remove nodes to the etcd cluster, use <code>etcdctl member add</code> and <code>etcdctl member remove</code> as found in <code>Replacing
a Seed Node</code> below. A general rule to keep in mind is that any time the M3DB process starts on a seed node, the list of
cluster members in <code>etcdctl member list</code> must match <em>exactly</em> the list in config.</p>
<h4 id="replacing-a-node">Replacing a Node</h4>
<p><strong>NOTE</strong>: If using embedded etcd and replacing a seed node, please read the section below.</p>
<p>Send a POST request to the <code>/api/v1/services/m3db/placement/replace</code> endpoint containing hosts to replace and candidates to replace it with.</p>
<div class="highlight"><pre><span></span><code>curl -X POST &lt;M3_COORDINATOR_HOST_NAME&gt;:&lt;M3_COORDINATOR_PORT<span class="o">(</span>default <span class="m">7201</span><span class="o">)</span>&gt;/api/v1/services/m3db/placement/replace -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;leavingInstanceIDs&quot;: [&quot;&lt;OLD_NODE_ID&gt;&quot;],</span>
<span class="s1">    &quot;candidates&quot;: [</span>
<span class="s1">        {</span>
<span class="s1">          &quot;id&quot;: &quot;&lt;NEW_NODE_ID&gt;&quot;,</span>
<span class="s1">          &quot;isolationGroup&quot;: &quot;&lt;NEW_NODE_ISOLATION_GROUP&gt;&quot;,</span>
<span class="s1">          &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,</span>
<span class="s1">          &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,</span>
<span class="s1">          &quot;endpoint&quot;: &quot;&lt;NEW_NODE_HOST_NAME&gt;:&lt;NEW_NODE_PORT&gt;(default 9000)&quot;,</span>
<span class="s1">          &quot;hostname&quot;: &quot;&lt;NEW_NODE_HOST_NAME&gt;&quot;,</span>
<span class="s1">          &quot;port&quot;: &lt;NEW_NODE_PORT&gt;</span>
<span class="s1">        }</span>
<span class="s1">    ]</span>
<span class="s1">}&#39;</span>
</code></pre></div>

<h4 id="replacing-a-seed-node">Replacing a Seed Node</h4>
<p>If you are using the embedded etcd mode (which is only recommended for test purposes) and replacing a seed node then
there are a few more steps to be done, as you are essentially doing two replace operations at once (replacing an etcd
node <em>and</em> and M3DB node). To perform these steps you will need the <code>etcdctl</code> binary (version 3.2 or later), which can
be downloaded from the <a href="https://github.com/etcd-io/etcd/releases">etcd releases</a> page.</p>
<p>Many of the instructions here are mentioned in the <a href="https://github.com/etcd-io/etcd/blob/v3.3.11/Documentation/op-guide/runtime-configuration.md">etcd operational
guide</a>, which we recommend
reading for more context.</p>
<p>To provide some context for the commands below, let's assume your cluster was created with the below configuration, and
that you'd like to replace <code>host3</code> with a new host <code>host4</code>, which has IP address <code>1.1.1.4</code>:</p>
<div class="highlight"><pre><span></span><code>initialCluster:
  - hostID: host1
    endpoint: http://1.1.1.1:2380
  - hostID: host2
    endpoint: http://1.1.1.2:2380
  - hostID: host3
    endpoint: http://1.1.1.3:2380
</code></pre></div>

<ol>
<li>On an existing node in the cluster that is <strong>not</strong> the one you're removing, use <code>etcdctl</code> to remove <code>host3</code> from the
   cluster:</li>
</ol>
<div class="highlight"><pre><span></span><code>$ ETCDCTL_API=3 etcdctl member list
9d29673cf1328d1, started, host1, http://1.1.1.1:2380, http://1.1.1.1:2379
f14613b6c8a336b, started, host2, http://1.1.1.2:2380, http://1.1.1.2:2379
2fd477713daf243, started, host3, http://1.1.1.3:2380, http://1.1.1.3:2379  # &lt;&lt;&lt; INSTANCE WE WANT TO REMOVE

$ ETCDCTL_API=3 etcdctl member remove 2fd477713daf243
Removed member 2fd477713daf243 from cluster
</code></pre></div>

<ol>
<li>From the same host, use <code>etcdctl</code> to add <code>host4</code> to the cluster:</li>
</ol>
<div class="highlight"><pre><span></span><code>$ ETCDCTL_API=3 etcdctl member add host4 --peer-urls http://1.1.1.4:2380
</code></pre></div>

<ol>
<li><strong>Before</strong> starting M3DB on <code>host4</code>, modify the initial cluster list to indicate <code>host4</code> has a cluster state of
   <code>existing</code>. Note: if you had previously started M3DB on this host, you'll have to remove the <code>member</code> subdirectory in
   <code>$M3DB_DATA_DIR/etcd/</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code>initialCluster:
  - hostID: host1
    endpoint: http://1.1.1.1:2380
  - hostID: host2
    endpoint: http://1.1.1.2:2380
  - hostID: host4
    clusterState: existing
    endpoint: http://1.1.1.4:2380
</code></pre></div>

<ol>
<li>
<p>Start M3DB on <code>host4</code>.</p>
</li>
<li>
<p>On all other seed nodes, update their <code>initialCluster</code> list to be exactly equal to the list on <code>host4</code> from step 3.
   Rolling restart the hosts one at a time, waiting until they indicate they are bootstrapped (indicated in the
   <code>/health</code>) endpoint before continuing to the next.</p>
</li>
<li>
<p>Follow the steps from <code>Replacing a Seed Node</code> to replace <code>host3</code> with <code>host4</code> in the M3DB placement.</p>
</li>
</ol>
<h4 id="setting-a-new-placement-not-recommended">Setting a new placement (Not Recommended)</h4>
<p>This endpoint is unsafe since it creates a brand new placement and therefore should be used with extreme caution.
Some use cases for using this endpoint include:</p>
<ul>
<li>Changing IP addresses of nodes</li>
<li>Rebalancing shards</li>
</ul>
<p>If the placement for <code>M3DB</code> needs to be recreated, the <code>/api/v1/services/m3db/placement/set</code> can be used to do so.
Please note, a placement already needs to exist to use this endpoint. If no placement exists, use the <code>Placement Initialization</code>
endpoint described above. Also, as mentioned above, this endpoint creates an entirely new placement therefore 
complete placement information needs to be passed into the body of the request. The recommended way to this
is to get the existing placement using <code>/api/v1/placement</code> and modify that (as the <code>placement</code> field) along 
with two additional fields -- <code>version</code> and <code>confirm</code>. Please see below for a full example:</p>
<div class="highlight"><pre><span></span><code>curl -X POST localhost:7201/api/v1/services/m3db/placement/set -d <span class="s1">&#39;{</span>
<span class="s1">  &quot;placement&quot;: {</span>
<span class="s1">    &quot;num_shards&quot;: &lt;DESIRED_NUMBER_OF_SHARDS&gt;,</span>
<span class="s1">    &quot;replication_factor&quot;: &lt;DESIRED_REPLICATION_FACTOR&gt;(recommended 3),</span>
<span class="s1">    &quot;instances&quot;: [</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;&lt;NODE_1_ID&gt;&quot;,</span>
<span class="s1">            &quot;isolation_group&quot;: &quot;&lt;NODE_1_ISOLATION_GROUP&gt;&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,</span>
<span class="s1">            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;&lt;NODE_1_HOST_NAME&gt;:&lt;NODE_1_PORT&gt;&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;&lt;NODE_1_HOST_NAME&gt;&quot;,</span>
<span class="s1">            &quot;port&quot;: &lt;NODE_1_PORT&gt;</span>
<span class="s1">        },</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;&lt;NODE_2_ID&gt;&quot;,</span>
<span class="s1">            &quot;isolation_group&quot;: &quot;&lt;NODE_2_ISOLATION_GROUP&gt;&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,</span>
<span class="s1">            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;&lt;NODE_2_HOST_NAME&gt;:&lt;NODE_2_PORT&gt;&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;&lt;NODE_2_HOST_NAME&gt;&quot;,</span>
<span class="s1">            &quot;port&quot;: &lt;NODE_2_PORT&gt;</span>
<span class="s1">        },</span>
<span class="s1">        {</span>
<span class="s1">            &quot;id&quot;: &quot;&lt;NODE_3_ID&gt;&quot;,</span>
<span class="s1">            &quot;isolation_group&quot;: &quot;&lt;NODE_3_ISOLATION_GROUP&gt;&quot;,</span>
<span class="s1">            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,</span>
<span class="s1">            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,</span>
<span class="s1">            &quot;endpoint&quot;: &quot;&lt;NODE_3_HOST_NAME&gt;:&lt;NODE_3_PORT&gt;&quot;,</span>
<span class="s1">            &quot;hostname&quot;: &quot;&lt;NODE_3_HOST_NAME&gt;&quot;,</span>
<span class="s1">            &quot;port&quot;: &lt;NODE_3_PORT&gt;</span>
<span class="s1">        }</span>
<span class="s1">      ]</span>
<span class="s1">    },</span>
<span class="s1">    &quot;version&quot;: &lt;version&gt;,</span>
<span class="s1">    &quot;confirm&quot;: &lt;true/false&gt;</span>
<span class="s1">}&#39;</span>
</code></pre></div>

<p><strong>Note:</strong> The <code>set</code> endpoint can also be used to set the placements in <code>M3Aggregator</code> and <code>M3Coordinator</code> using the following endpoints, respectively:
<div class="highlight"><pre><span></span><code>/api/v1/m3aggregator/set
/api/v1/m3coordinator/set
</code></pre></div></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../placement/" title="Placement/Topology" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Placement/Topology
              </div>
            </div>
          </a>
        
        
          <a href="../namespace_configuration/" title="Namespace Configuration" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Namespace Configuration
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.c3dc8c49.min.js"></script>
      <script src="../../assets/javascripts/bundle.f9edbbd5.min.js"></script><script id="__lang" type="application/json">{"search.config.lang": "en", "search.result.placeholder": "Type to start searching", "search.config.pipeline": "trimmer, stopWordFilter", "search.result.one": "1 matching document", "clipboard.copied": "Copied to clipboard", "search.config.separator": "[\\s\\-]+", "search.result.other": "# matching documents", "clipboard.copy": "Copy to clipboard", "search.result.none": "No matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>